<!DOCTYPE html>
<html>
<head>
<style>
html {
  background-color: #800000;
}
</style>
    <script src="js/phaser.min.js"></script>
</head>
<body>

<script>

var music;
  
  class SceneA extends Phaser.Scene {
      constructor (config) {
         super({ key: 'SceneA' });
      }
      
      preload() {
        //this.load.audio('theme','audio/theme.ogg');
        this.load.image('banner','img/banner.png');
        this.load.image('surprise','img/surprise.png');
        for (var i=1;i<=24;i++) {
          this.load.image(("0"+i).slice(-2),'img/'+("0"+i).slice(-2)+'.jpg');
        }
      }
      
      create() {   
        //music = this.sound.add('theme');
        //music.play();
        var banner = this.add.image(0, 0, 'banner').setOrigin(0, 0).setInteractive();
         banner.on('pointerdown', function (pointer) {
            window.location.assign("https://www.facebook.com/CollettivoGrandeCinema");
          });
        
        var days = new Array(24);       
        var one_day=1000*60*60*24;
        var today = new Date();
        
        var i;
        var x = 600;
        var y = 0;
        //for (i=4;i<=24;i++) {
        for (i=0;i<24;i++) {        
          // month is 0-11
          var dia = new Date(2021, 11, i+1);
          var difference_ms = dia.getTime() - today.getTime();
          var days_till = 0;
          if ( difference_ms > 0 )
              days_till = Math.round(difference_ms/one_day) + 1;
          if ( days_till > 0 ) {
            days[i] = this.add.image(x,y,'surprise').setOrigin(0, 0).setInteractive();
            this.add.text(x+5, y, i+1, { font: '28px Arial' }).setOrigin(0, 0);
          } else {
          /*
            if ( i < 3 )
            {
              if ( 0 == i )
              {
                days[0] = this.add.image(600,0,'01').setOrigin(0, 0).setInteractive();                
                this.add.text(605, 0, "1", { font: '28px Arial', fill: '#EE0000' }).setOrigin(0, 0);
              }
              else if ( 1 == i )
              {
                days[1] = this.add.image(750,0,'02').setOrigin(0, 0).setInteractive();
                this.add.text(755, 0, "2", { font: '28px Arial', fill: '#EE0000' }).setOrigin(0, 0);
              }
              else // if ( 2 == i )
              {
                days[2] = this.add.image(900,0,'03').setOrigin(0, 0).setInteractive();
                this.add.text(905, 0, "3", { font: '28px Arial', fill: '#EE0000' }).setOrigin(0, 0);
              }
              
              //days[i].__activated = true; days[i].__index = i+1;
            
            }
            else
            */
            {
              days[i] = this.add.image(x,y,("0"+(i+1)).slice(-2)).setOrigin(0, 0).setInteractive();
              if ( (10 == i) || (14 == i) || (22 == i) || (25 == i) || (3 == i) || (0 == i) || (1 == i) )
                this.add.text(x+5, y, i+1, { font: '28px Arial', fill: '#EE0000' }).setOrigin(0, 0);
              else
                this.add.text(x+5, y, i+1, { font: '28px Arial' }).setOrigin(0, 0);
            }
          }
          days[i].__index = i+1;
          days[i].__days_till = days_till;
          
          if ( x > 750 ) {
            x = 0;
            y += 150;
          }
          else
            x += 150;
        }
       
        for (i=0;i<24;i++) {
          days[i].on('pointerdown', function (pointer) {
            game.scene.stop('SceneA');
            game.scene.start('SceneB', {id: this.__index, days_till: this.__days_till });
          });
        }
          
        var graphics = this.add.graphics(0, 0);
        graphics.lineStyle(2, 0x550000, 1);
        graphics.strokeRect(0, 0, 1050, 150);
        x = 0;
        y = 150;
        for (i=3;i<24;i++) {
          graphics.strokeRect(x, y, 150, 150);
          if ( x > 750 ) {
            x = 0;
            y += 150;
          }
          else
            x+=150;
        }
      }
  }
  
class SceneB extends Phaser.Scene
{
  constructor (config)
  {
    super({ key: 'SceneB' });
  }
  
  init(data)
  {
    this.videoId = data.id;
    this.daysTill = data.days_till;
  }
  
  preload()
  {
    if ( this.daysTill > 0 )
      this.load.video('error','movies/error.webm', 'loadeddata', false, false);
    else
      this.load.video(("0"+this.videoId).slice(-2),'movies/'+("0"+this.videoId).slice(-2)+'.webm', 'loadeddata', false, false);
      
    this.load.image('stop','img/stop.png');
  }
    
  create()
  {
    var title = [  "Le 7 spade della vendetta (1993)"                // 01
                , "Hellgate (1989)"                          // 02
                , "Demonio Amore Mio (1987)"     // 03
                , "American Riscio' (1989)"      // 04
                , "Italian Boys (1982)"   // 05
                , "Final Round (1994)"   // 06
                , "Seytan (1974)"           // 07
                , "Transformer (1984)"     // 08
                , "Night Vision (1987)"                      // 09
                , "La Ragazza dal Pigiama Giallo (1977)"   // 10
                , "La Casa Sperduta nel Parco (1980)"   // 11
                , "Alla Ricerca dell'Impero Sepolto (1987)"   // 12
                , "Trog - Il Terrore di Londra (1970)"   // 13
                , "Play Motel (1979)"   // 14
                , "Grazie Padre Pio (2001)"   // 15
                , "Phantasm (1979)"   // 16
                , "Cani Arrabbiati (1974)"   // 17
                , "Roma a mano armata (1976)"   // 18
                , "L'Invincibile Batman (1973)" // 19
                , "I guerrieri dell'anno 2072 (1984)"   // 20
                , "La croce dalle sette pietre (1987)"   // 21
                , "House IV - Presenze Impalpabili (1992)"   // 22
                , "Il Club dei Mostri (1980)"   // 23
                , "Grazie Padre Pio (2001)"              // 24
    ];    
    
    var video;
    if ( this.daysTill > 0 )
      video = this.add.video(0, 0, 'error').setOrigin(0, 0).setInteractive();
    else
      video = this.add.video(0, 0, ("0"+this.videoId).slice(-2)).setOrigin(0, 0).setInteractive();
    var scale = Math.min(game.config.width / video.width, (game.config.height - 150) / video.height);
    video.setScale(scale);
    video.x = (game.config.width - video.width*scale) / 2;
    video.y = (game.config.height - video.height*scale) / 2;
    
    var graphics = this.add.graphics(0, 0);
    graphics.fillStyle(0x800000, 1);
    graphics.fillRect(0, 0, game.config.width, video.y);
    graphics.lineStyle(2, 0x550000, 1);
    graphics.strokeRect(0, 0, game.config.width, game.config.height);
  
    var text;
    if ( this.daysTill > 0 )
    {
      if (this.daysTill > 1 )
        text = this.add.text(0, 0, "Devi attendere " + (this.daysTill) + " giorni!", { font: '64px Arial' }).setOrigin(0, 0);
      else
        text = this.add.text(0, 0, "Devi attendere fino a domani!", { font: '64px Arial' }).setOrigin(0, 0);
    } else
      text = this.add.text(0, 0, title[this.videoId-1], { font: '64px Arial' }).setOrigin(0, 0);
    var maxAllowedTextWidth = game.config.width - 80;
    var scale = Math.min(maxAllowedTextWidth / text.width, video.y / text.height);
    text.setScale(scale);
    text.x = (maxAllowedTextWidth - text.width*scale) / 2;
    text.y = (video.y - text.height*scale) / 2;
    
    var stop = this.add.image(maxAllowedTextWidth+10, 0,'stop').setOrigin(0, 0).setInteractive();
    stop.y = (video.y - stop.height) / 2;
    stop.on('pointerdown', function (pointer)
      {
        video.stop();
        game.scene.stop('SceneB');
        game.scene.start('SceneA');
      }
    );
    
    video.play(false);  
    video.on('complete', function(video)
      {
        game.scene.stop('SceneB');
        game.scene.start('SceneA');
      }
      , this
    );
  }
}
    
var config = {
  type: Phaser.AUTO,
  width: 1050,
  height: 600,
  backgroundColor: '#800000',
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH,
  },
  scene: [ SceneA, SceneB ]
};

var game = new Phaser.Game(config);

</script>

</body>
</html>